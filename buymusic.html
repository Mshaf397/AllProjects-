<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Original Compositions - Score Marketplace</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Custom styles for aesthetic buttons */
        .buy-button {
            transition: all 0.15s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .buy-button:hover {
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
            transform: translateY(-1px);
        }
        .buy-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">

    <!-- 
    ===================================================================
    ====================== MUSIC SCORE DATA CONFIG ====================
    
    *** EDIT THIS SECTION TO ADD, REMOVE, OR UPDATE YOUR MUSIC SCORES ***
    
    The 'file_path' is now a direct link to the PDF, relative to where 
    this index.html file is hosted (e.g., example_score.pdf).
    ===================================================================
    -->
    <script>
        const SCORE_CATALOG = [
            { 
                id: 1, 
                title: "Nigun Simcha (Em)", 
                price: "4.99", 
                description: "A very energetic song, perfect for dancing to. Arranged for piano, guitar, and bass. Key of Em.", 
                file_path: "Nigun Simcha.pdf" // <-- EDIT THIS LINK (e.g., use 'scores/symphony-5.pdf')
            },
            { 
                id: 2, 
                title: "Light", 
                price: "9.99", 
                description: "A short, lyrical solo piano piece suitable for intermediate players.", 
                file_path: "Light.pdf" // <-- EDIT THIS LINK
            },
            { 
                id: 3, 
                title: "Nigun Simcha (Ebm)", 
                price: "5.49", 
                description: "A very energetic song, perfect for dancing to. Arranged for piano, guitar (no tab), and drums. Key of Ebm.", 
                file_path: "Nigun Simcha Ebm.pdf" // <-- EDIT THIS LINK
            },
            // Add new scores here:
            // { 
            //     id: 4, 
            //     title: "New Score Title", 
            //     price: "9.99", 
            //     description: "Description of the new piece.", 
            //     file_path: "new-score.pdf"
            // },
        ];
    </script>
    <!-- =============================================================== -->


    <!-- Header & Navigation (Fixed at top) -->
    <header class="bg-white shadow-lg sticky top-0 z-10">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <h1 class="text-3xl font-extrabold text-indigo-700 tracking-tight">
                Gedaliah Shaffer's Music Scores
            </h1>
            <nav>
                <button onclick="navigate('home')" class="text-indigo-600 hover:text-indigo-800 font-medium px-3 py-1 rounded-md">
                    Store
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content Container -->
    <main id="app-container" class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Content will be injected here -->
    </main>

    <!-- Modal for Download/Error Messages (Replaces alert()) -->
    <div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm transform transition-all">
            <h3 id="modal-title" class="text-xl font-bold mb-3 text-indigo-700"></h3>
            <p id="modal-body" class="text-gray-600 mb-6"></p>
            <div class="flex justify-end">
                <button onclick="closeModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 buy-button">
                    Close
                </button>
            </div>
        </div>
    </div>


    <script>
        // --- STATE & NAVIGATION ---
        let currentPage = 'home';
        let selectedScore = null;
        const appContainer = document.getElementById('app-container');
        
        // Use the globally defined SCORE_CATALOG
        const musicScores = SCORE_CATALOG;

        function navigate(page, scoreId = null) {
            currentPage = page;
            appContainer.innerHTML = ''; // Clear previous content

            if (scoreId) {
                // Ensure we find the score using the globally accessible data
                selectedScore = musicScores.find(s => s.id === scoreId);
            }

            switch (page) {
                case 'home':
                    renderHome();
                    break;
                case 'checkout':
                    renderCheckout();
                    break;
                case 'download':
                    renderDownload();
                    break;
                default:
                    renderHome();
            }
            window.scrollTo(0, 0); // Scroll to top on navigation
        }

        // --- MODAL UTILITIES ---

        function showModal(title, body) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = body;
            document.getElementById('message-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('message-modal').classList.add('hidden');
        }

        // --- RENDER FUNCTIONS ---

        function renderHome() {
            const scoreListHTML = musicScores.map(score => `
                <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col md:flex-row justify-between items-center mb-6 border-t-4 border-indigo-500">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">${score.title}</h2>
                        <p class="text-gray-600 mt-2 max-w-prose">${score.description}</p>
                        <p class="text-3xl font-extrabold text-green-600 mt-4">$${score.price}</p>
                    </div>
                    <button
                        onclick="navigate('checkout', ${score.id})"
                        class="buy-button mt-4 md:mt-0 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 transform hover:scale-105"
                    >
                        Buy Now
                    </button>
                </div>
            `).join('');

            appContainer.innerHTML = `
                <section class="text-center mb-10">
                    <h2 class="text-4xl font-extrabold text-gray-900 mb-2">My Original Music Scores</h2>
                    <p class="text-xl text-indigo-600">Download high-quality PDF files of my compositions.</p>
                </section>
                <section>
                    ${scoreListHTML}
                </section>
            `;
        }

        function renderCheckout() {
            if (!selectedScore) {
                navigate('home');
                return;
            }

            appContainer.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-6 sm:p-10 max-w-2xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Complete Your Purchase</h2>
                    <p class="text-xl text-indigo-600 mb-6">${selectedScore.title} - $${selectedScore.price}</p>

                    <!-- Step 1: Payment via QR Code -->
                    <div class="mb-8 border-b pb-6">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Step 1: Send Payment via BusyKid</h3>
                        <p class="text-gray-600 mb-4">Please scan the QR code below to complete the $${selectedScore.price} payment.</p>

                        <div class="flex justify-center items-center p-4 bg-gray-100 rounded-lg shadow-inner">
                            <!-- Placeholder for your BusyKid QR Code (REPLACE THIS IMAGE) -->
                            <img
                                src="IMG_0480.jpeg"
                                alt="BusyKid Payment QR Code"
                                class="rounded-lg border-4 border-indigo-500"
                                onerror="this.onerror=null; this.src='IMG_0490.jpeg';"
                            />
                        </div>
                    </div>

                    <!-- Step 2: Verification Form -->
                    <div>
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Step 2: Verify & Download</h3>
                        <p class="text-gray-600 mb-4">After sending payment, please fill out this form to receive your secure download link immediately.</p>

                        <form id="verification-form" class="space-y-4">
                            <div>
                                <label for="buyer-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="buyer-name" name="name" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-3 border"
                                    placeholder="Jane Doe">
                            </div>
                            <div>
                                <label for="buyer-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" id="buyer-email" name="email" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-3 border"
                                    placeholder="you@example.com">
                            </div>

                            <button type="submit"
                                class="buy-button w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition duration-150 mt-6">
                                Confirm Payment & Get Download Link
                            </button>
                        </form>
                    </div>
                </div>
            `;
            // Attach event listener after injecting HTML
            document.getElementById('verification-form').addEventListener('submit', handleVerification);
        }

        function renderDownload() {
            if (!selectedScore) {
                navigate('home');
                return;
            }

            appContainer.innerHTML = `
                <div class="bg-green-50 border-l-4 border-green-400 text-green-700 p-4 rounded-lg mb-8" role="alert">
                    <p class="font-bold">Success!</p>
                    <p>Your payment confirmation is complete. Thank you for your purchase!</p>
                </div>

                <div class="bg-white rounded-xl shadow-2xl p-6 sm:p-10 max-w-2xl mx-auto text-center">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6">Your Score is Ready</h2>
                    <p class="text-gray-600 mb-6">Click the button below to download the high-resolution PDF file for **${selectedScore.title}**.</p>

                    <!-- Direct link to the score using the local file path -->
                    <a href="${selectedScore.file_path}" target="_blank" download="${selectedScore.file_path}"
                        class="buy-button inline-block bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg transition duration-150 transform hover:scale-105 text-lg">
                        Download Score (PDF)
                    </a>

                    <p class="text-sm text-gray-400 mt-8">File path: ${selectedScore.file_path}</p>
                </div>
            `;

            // Clear the selected score after showing download
            selectedScore = null;
        }

        // --- HANDLER FUNCTIONS ---

        function handleVerification(event) {
            event.preventDefault();

            // Minimal validation check
            const name = document.getElementById('buyer-name').value.trim();
            const email = document.getElementById('buyer-email').value.trim();

            if (!name || !email) {
                showModal("Error", "Please fill out both your Name and Email address.");
                return;
            }

            // Simulate a brief processing delay for realism
            const submitButton = event.target.querySelector('button[type="submit"]');
            submitButton.textContent = "Processing...";
            submitButton.disabled = true;

            setTimeout(() => {
                // Navigate to the final download page
                navigate('download');
            }, 1500);
        }

        // --- INITIALIZATION ---
        // Start the application on the home page when the script loads
        document.addEventListener('DOMContentLoaded', () => {
            navigate('home');
        });

    </script>
</body>
</html>