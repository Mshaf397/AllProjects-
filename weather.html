<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Weather App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
        }
        .container {
            max-width: 1280px;
        }
        .card {
            background-color: #ffffff;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .scroll-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .scroll-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="container mx-auto p-4 md:p-8">
        <!-- Search and Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800">Weather Forecast</h1>
            <div class="mt-4 flex flex-col sm:flex-row justify-center items-center gap-4">
                <input type="text" id="location-input" placeholder="Enter city or zip code" class="p-3 w-full sm:w-80 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-200 shadow-sm">
                <button id="search-button" class="bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700 transition-colors duration-200 shadow-md">Get Weather</button>
            </div>
            <div class="mt-2 flex flex-col sm:flex-row justify-center items-center gap-2">
                <input type="number" id="lat-input" placeholder="Latitude" class="p-3 w-full sm:w-40 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-200 shadow-sm">
                <input type="number" id="lon-input" placeholder="Longitude" class="p-3 w-full sm:w-40 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-200 shadow-sm">
            </div>
            <p id="error-message" class="text-red-500 mt-2 hidden">Please enter a valid location or valid coordinates.</p>
        </header>

        <!-- Main Weather Display -->
        <main class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Current Weather Card -->
            <div id="current-weather-card" class="md:col-span-1 bg-gradient-to-br from-indigo-500 to-indigo-700 text-white rounded-2xl p-6 shadow-xl transform transition-transform hover:scale-105 duration-300 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="current-city" class="text-3xl font-semibold"></h2>
                    <span id="current-date" class="text-lg opacity-80"></span>
                </div>
                <div class="flex justify-center items-center flex-col my-8">
                    <div class="text-7xl font-bold mb-2">
                        <span id="current-temp"></span><span class="text-4xl align-top">Â°C</span>
                    </div>
                    <p id="current-description" class="text-xl capitalize"></p>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm opacity-90">
                    <div class="flex flex-col items-start">
                        <span class="font-medium">Feels Like:</span>
                        <span id="feels-like" class="font-light"></span>
                    </div>
                    <div class="flex flex-col items-end">
                        <span class="font-medium">Humidity:</span>
                        <span id="humidity" class="font-light"></span>
                    </div>
                    <div class="flex flex-col items-start">
                        <span class="font-medium">Wind Speed:</span>
                        <span id="wind-speed" class="font-light"></span>
                    </div>
                    <div class="flex flex-col items-end">
                        <span class="font-medium">Precipitation:</span>
                        <span id="precipitation" class="font-light"></span>
                    </div>
                    <div class="flex flex-col items-start">
                        <span class="font-medium">Cloud Cover:</span>
                        <span id="cloud-cover" class="font-light"></span>
                    </div>
                    <div class="flex flex-col items-end">
                        <span class="font-medium">UV Index:</span>
                        <span id="uv-index" class="font-light"></span>
                    </div>
                </div>
            </div>

            <!-- Hourly and Daily Forecasts -->
            <div id="forecast-container" class="md:col-span-2 space-y-8 hidden">
                <!-- Hourly Forecast -->
                <section class="card rounded-2xl p-6 shadow-xl">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">72-Hour Forecast</h3>
                    <div id="hourly-forecast" class="flex overflow-x-auto gap-4 py-2 scroll-container">
                        <!-- Hourly cards will be inserted here by JavaScript -->
                    </div>
                </section>
                <!-- Daily Forecast -->
                <section class="card rounded-2xl p-6 shadow-xl">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-4">16-Day Forecast</h3>
                    <div id="daily-forecast" class="space-y-4">
                        <!-- Daily cards will be inserted here by JavaScript -->
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchButton = document.getElementById('search-button');
            const locationInput = document.getElementById('location-input');
            const latInput = document.getElementById('lat-input');
            const lonInput = document.getElementById('lon-input');
            const errorMessage = document.getElementById('error-message');
            const currentWeatherCard = document.getElementById('current-weather-card');
            const forecastContainer = document.getElementById('forecast-container');

            const API_BASE_URL = 'https://api.open-meteo.com/v1/forecast';

            // Fetches weather data from the Open-Meteo API
            async function fetchWeather(latitude, longitude) {
                const url = `${API_BASE_URL}?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,apparent_temperature,precipitation,rain,showers,snowfall,weather_code,cloud_cover,pressure_msl,relative_humidity_2m,wind_speed_10m&hourly=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,wind_speed_10m,uv_index&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max,sunrise,sunset&timezone=auto&forecast_days=16`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Failed to fetch weather data:', error);
                    return null;
                }
            }

            // Fetches location data from the GeoCoding API (for city name search)
            async function fetchLocation(location) {
                const url = `https://geocoding-api.open-meteo.com/v1/search?name=${location}&count=1&language=en&format=json`;

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    if (data.results && data.results.length > 0) {
                        return data.results[0];
                    }
                    return null;
                } catch (error) {
                    console.error('Failed to fetch location data:', error);
                    return null;
                }
            }
            
            // Fetches location name from coordinates (reverse geocoding)
            async function fetchLocationName(latitude, longitude) {
                const url = `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${latitude}&longitude=${longitude}&count=1&language=en&format=json`;

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    if (data.results && data.results.length > 0) {
                        const { name, country } = data.results[0];
                        return { name, country };
                    }
                    return { name: `Lat: ${latitude}, Lon: ${longitude}`, country: '' };
                } catch (error) {
                    console.error('Failed to fetch location name:', error);
                    return { name: `Lat: ${latitude}, Lon: ${longitude}`, country: '' };
                }
            }


            // Displays the current weather
            function displayCurrentWeather(data, city, country) {
                if (!data || !data.current || !data.hourly) {
                    errorMessage.textContent = 'Weather data not available for this location.';
                    errorMessage.classList.remove('hidden');
                    currentWeatherCard.classList.add('hidden');
                    forecastContainer.classList.add('hidden');
                    return;
                }

                const currentWeather = data.current;
                const hourlyData = data.hourly;
                
                // Find the closest hourly data point to the current time
                const currentTime = moment.utc(currentWeather.time);
                const currentHourIndex = hourlyData.time.findIndex(time => moment.utc(time).isSameOrAfter(currentTime));
                const currentHourlyPoint = hourlyData.time[currentHourIndex] ? {
                    cloud_cover: hourlyData.cloud_cover[currentHourIndex],
                    uv_index: hourlyData.uv_index[currentHourIndex]
                } : null;

                document.getElementById('current-city').textContent = `${city}, ${country}`;
                document.getElementById('current-date').textContent = moment(currentWeather.time).format('MMMM Do');
                document.getElementById('current-temp').textContent = Math.round(currentWeather.temperature_2m);
                document.getElementById('feels-like').textContent = `${Math.round(currentWeather.apparent_temperature)}Â°C`;
                document.getElementById('humidity').textContent = `${currentWeather.relative_humidity_2m}%`;
                document.getElementById('wind-speed').textContent = `${currentWeather.wind_speed_10m} km/h`;
                document.getElementById('precipitation').textContent = `${currentWeather.precipitation || 0} mm`;
                
                if (currentHourlyPoint) {
                    document.getElementById('cloud-cover').textContent = `${currentHourlyPoint.cloud_cover}%`;
                    document.getElementById('uv-index').textContent = currentHourlyPoint.uv_index.toFixed(1);
                }

                // Get a simple description from the weather code
                const weatherDescription = getWeatherDescription(currentWeather.weather_code);
                document.getElementById('current-description').textContent = weatherDescription;

                currentWeatherCard.classList.remove('hidden');
            }

            // Displays the 72-hour forecast starting from the next full hour
            function displayHourlyForecast(hourlyData) {
                const hourlyForecastContainer = document.getElementById('hourly-forecast');
                hourlyForecastContainer.innerHTML = '';
                
                // Get the current local moment
                const currentMoment = moment();

                // Find the index of the first hour that is strictly *after* the current moment
                let startIndex = hourlyData.time.findIndex(time => moment(time).isAfter(currentMoment));
                
                // Fallback in case no future hours are found, though this is unlikely with a 72-hour forecast
                if (startIndex === -1) {
                    startIndex = hourlyData.time.length - 1;
                }

                // Loop for 72 hours starting from the found index
                for (let i = startIndex; i < startIndex + 72 && i < hourlyData.time.length; i++) {
                    const time = hourlyData.time[i];
                    const temp = Math.round(hourlyData.temperature_2m[i]);
                    const weatherCode = hourlyData.weather_code[i];
                    const cloudCover = hourlyData.cloud_cover[i];
                    const uvIndex = hourlyData.uv_index[i];

                    const forecastTime = moment.utc(time);
                    const card = document.createElement('div');
                    card.className = 'flex flex-col items-center bg-gray-50 rounded-xl p-4 shadow-sm w-32 flex-shrink-0';
                    card.innerHTML = `
                        <p class="font-medium text-gray-700">${forecastTime.format('ha')}</p>
                        <img src="${getWeatherIcon(weatherCode)}" alt="weather icon" class="w-10 h-10 my-2">
                        <p class="text-xl font-bold">${temp}Â°C</p>
                        <p class="text-xs text-gray-500 mt-1">Clouds: ${cloudCover}%</p>
                        <p class="text-xs text-gray-500">UV: ${uvIndex.toFixed(1)}</p>
                    `;
                    hourlyForecastContainer.appendChild(card);
                }
            }

            // Displays the 16-day daily forecast
            function displayDailyForecast(dailyData) {
                const dailyForecastContainer = document.getElementById('daily-forecast');
                dailyForecastContainer.innerHTML = '';

                // Loop for the entire daily forecast length (up to 16 days)
                for (let i = 0; i < dailyData.time.length; i++) {
                    const time = dailyData.time[i];
                    const maxTemp = Math.round(dailyData.temperature_2m_max[i]);
                    const minTemp = Math.round(dailyData.temperature_2m_min[i]);
                    const weatherCode = dailyData.weather_code[i];
                    const uvIndexMax = dailyData.uv_index_max[i];
                    // Retrieve sunrise and sunset times
                    const sunriseTime = moment(dailyData.sunrise[i]).format('h:mm A');
                    const sunsetTime = moment(dailyData.sunset[i]).format('h:mm A');

                    const card = document.createElement('div');
                    card.className = 'flex items-center justify-between bg-gray-50 rounded-xl p-4 shadow-sm';
                    card.innerHTML = `
                        <p class="font-medium text-gray-700 w-24">${moment(time).format('ddd, MMM D')}</p>
                        <img src="${getWeatherIcon(weatherCode)}" alt="weather icon" class="w-10 h-10">
                        <div class="flex flex-col items-center w-24 text-sm text-gray-500">
                          <p>UV Max: ${uvIndexMax.toFixed(1)}</p>
                          <p>âï¸ ${sunriseTime}</p>
                          <p>ð ${sunsetTime}</p>
                        </div>
                        <p class="font-bold text-gray-800 text-right w-24">${maxTemp}Â°C / <span class="text-gray-500">${minTemp}Â°C</span></p>
                    `;
                    dailyForecastContainer.appendChild(card);
                }
            }

            // Maps weather codes to simple descriptions
            function getWeatherDescription(code) {
                const descriptions = {
                    0: 'Clear sky',
                    1: 'Mainly clear',
                    2: 'Partly cloudy',
                    3: 'Overcast',
                    45: 'Fog',
                    48: 'Depositing rime fog',
                    51: 'Light drizzle',
                    53: 'Moderate drizzle',
                    55: 'Dense drizzle',
                    56: 'Light freezing drizzle',
                    57: 'Dense freezing drizzle',
                    61: 'Slight rain',
                    63: 'Moderate rain',
                    65: 'Heavy rain',
                    66: 'Light freezing rain',
                    67: 'Heavy freezing rain',
                    71: 'Slight snow fall',
                    73: 'Moderate snow fall',
                    75: 'Heavy snow fall',
                    77: 'Snow grains',
                    80: 'Slight rain showers',
                    81: 'Moderate rain showers',
                    82: 'Violent rain showers',
                    85: 'Slight snow showers',
                    86: 'Heavy snow showers',
                    95: 'Thunderstorm',
                    96: 'Thunderstorm with slight hail',
                    99: 'Thunderstorm with heavy hail'
                };
                return descriptions[code] || 'N/A';
            }

            // Maps weather codes to icons (placeholder image)
            function getWeatherIcon(code) {
                const icons = {
                    0: 'https://placehold.co/40x40/5c6ac4/ffffff?text=âï¸',
                    1: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¤ï¸',
                    2: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¥ï¸',
                    3: 'https://placehold.co/40x40/5c6ac4/ffffff?text=âï¸',
                    45: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð«ï¸',
                    48: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð«ï¸',
                    51: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð§',
                    53: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð§',
                    55: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð§',
                    56: 'https://placehold.co/40x40/5c6ac4/ffffff?text=âï¸',
                    57: 'https://placehold.co/40x40/5c6ac4/ffffff?text=âï¸',
                    61: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð§ï¸',
                    63: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð§ï¸',
                    65: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð§ï¸',
                    66: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð§ï¸',
                    67: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð§ï¸',
                    71: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¨ï¸',
                    73: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¨ï¸',
                    75: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¨ï¸',
                    77: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¨ï¸',
                    80: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¦ï¸',
                    81: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¦ï¸',
                    82: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¦ï¸',
                    85: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¨ï¸',
                    86: 'https://placehold.co/40x40/5c6ac4/ffffff?text=ð¨ï¸',
                    95: 'https://placehold.co/40x40/5c6ac4/ffffff?text=âï¸',
                    96: 'https://placehold.co/40x40/5c6ac4/ffffff?text=âï¸',
                    99: 'https://placehold.co/40x40/5c6ac4/ffffff?text=âï¸'
                };
                return icons[code] || 'https://placehold.co/40x40/5c6ac4/ffffff?text=â';
            }

            searchButton.addEventListener('click', async () => {
                errorMessage.classList.add('hidden');
                
                const location = locationInput.value.trim();
                const lat = latInput.value.trim();
                const lon = lonInput.value.trim();

                let latitude, longitude, city, country;

                if (lat && lon) {
                    // Search by coordinates
                    latitude = parseFloat(lat);
                    longitude = parseFloat(lon);

                    if (isNaN(latitude) || isNaN(longitude)) {
                        errorMessage.textContent = 'Please enter valid numerical coordinates.';
                        errorMessage.classList.remove('hidden');
                        return;
                    }
                    
                    const locationNameData = await fetchLocationName(latitude, longitude);
                    city = locationNameData.name;
                    country = locationNameData.country;

                } else if (location) {
                    // Search by city/zip code
                    const locationData = await fetchLocation(location);
                    if (!locationData) {
                        errorMessage.textContent = 'Location not found. Please try again.';
                        errorMessage.classList.remove('hidden');
                        return;
                    }
                    latitude = locationData.latitude;
                    longitude = locationData.longitude;
                    city = locationData.name;
                    country = locationData.country;
                } else {
                    errorMessage.textContent = 'Please enter a location or coordinates.';
                    errorMessage.classList.remove('hidden');
                    return;
                }

                const weatherData = await fetchWeather(latitude, longitude);

                if (weatherData) {
                    displayCurrentWeather(weatherData, city, country);
                    displayHourlyForecast(weatherData.hourly);
                    displayDailyForecast(weatherData.daily);
                    forecastContainer.classList.remove('hidden');
                } else {
                    errorMessage.textContent = 'Failed to fetch weather data. Please try again later.';
                    errorMessage.classList.remove('hidden');
                }
            });
        });
    </script>
</body>
</html>
