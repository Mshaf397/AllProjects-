<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>All-In Weather</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<style>
:root{--bg:#0d1117;--fg:#e6edf3;--card:#161b22;--acc:#2f81f7;--ok:#2ea043;--mut:#8b949e}
@media(prefers-color-scheme:light){:root{--bg:#f6f8fa;--fg:#24292f;--card:#fff;--acc:#0969da;--ok:#2da44e;--mut:#57606a}}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--fg);font:14px system-ui}
header{background:var(--card);padding:10px;display:flex;gap:6px;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:2}
h1{margin:0;font-size:16px}small{color:var(--mut)}
.tab{padding:6px 10px;border-radius:6px;background:transparent;border:1px solid #0003;color:var(--fg);cursor:pointer}
.tab.active{background:var(--acc);color:#fff;border-color:transparent}
.panel{display:none;padding:10px}.panel.active{display:block}
.card{background:var(--card);padding:8px;border-radius:8px;margin-bottom:8px}
#map{height:300px;border-radius:8px;overflow:hidden}
input{padding:4px 6px;border:1px solid #0003;border-radius:4px;background:transparent;color:var(--fg)}
button{padding:5px 8px;border:1px solid #0003;border-radius:4px;background:transparent;color:var(--fg);cursor:pointer}
button.primary{background:var(--ok);color:#fff;border-color:transparent}
.grid{overflow:auto;border-radius:6px;border:1px solid #0003}
table{border-collapse:collapse;min-width:900px;width:100%;background:var(--card)}
th,td{padding:4px 6px;border-bottom:1px solid #0003;white-space:nowrap}
th{position:sticky;top:0;background:var(--card)}
.kv{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:4px}
.kv div{border:1px dashed #0003;padding:4px;border-radius:4px}
.badge{font-size:12px;color:var(--mut);margin-left:4px}
</style>
</head>
<body>
<header>
  <div><h1>All-In Weather</h1><small>Open-Meteo + OSM</small></div>
  <div>
    <button class="tab active" data-t="now">Now/Map</button>
    <button class="tab" data-t="hourly">Hourly</button>
    <button class="tab" data-t="daily">Daily</button>
  </div>
</header>

<section id="now" class="panel active">
  <div class="card">
    Lat <input id="lat" value="40.7128"> Lon <input id="lon" value="-74.0060">
    <button id="geo">Use My Location</button>
    <button id="go" class="primary">Fetch</button>
    <span id="tz" class="badge"></span>
  </div>
  <div id="map" class="card"></div>
  <div class="card">
    <div id="place"></div><div class="kv" id="currentKV"></div>
  </div>
</section>

<section id="hourly" class="panel">
  <div class="grid"><table id="hourlyTable"><thead></thead><tbody></tbody></table></div>
</section>

<section id="daily" class="panel">
  <div class="grid"><table id="dailyTable"><thead></thead><tbody></tbody></table></div>
</section>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const CURRENT=["temperature_2m","apparent_temperature","dew_point_2m","relative_humidity_2m","wind_speed_10m","wind_direction_10m","wind_gusts_10m","pressure_msl","surface_pressure","cloud_cover","cloud_cover_low","cloud_cover_mid","cloud_cover_high","precipitation","rain","showers","snowfall","snow_depth","shortwave_radiation","direct_radiation","diffuse_radiation","direct_normal_irradiance","uv_index","uv_index_clear_sky","visibility","cape","is_day","weather_code","freezing_level_height"];
const HOURLY=[...CURRENT,"wind_speed_80m","wind_speed_120m","wind_speed_180m","precipitation_probability","terrestrial_radiation","soil_temperature_0cm","soil_temperature_6cm","soil_temperature_18cm","soil_temperature_54cm","soil_moisture_0_to_7cm","soil_moisture_7_to_28cm","soil_moisture_28_to_100cm","soil_moisture_100_to_255cm","evapotranspiration","et0_fao_evapotranspiration"];
const DAILY=["temperature_2m_max","temperature_2m_min","apparent_temperature_max","apparent_temperature_min","precipitation_sum","rain_sum","showers_sum","snowfall_sum","precipitation_hours","weather_code","wind_speed_10m_max","wind_gusts_10m_max","wind_direction_10m_dominant","sunrise","sunset","daylight_duration","sunshine_duration","shortwave_radiation_sum","uv_index_max","uv_index_clear_sky_max","et0_fao_evapotranspiration","snow_depth_max","freezing_level_height_mean"];
const $=s=>document.querySelector(s),fmt=v=>v==null?"â€”":+v.toFixed? (Math.abs(v)>=10?v.toFixed(1):v.toFixed(2)):v;
let map,marker;
function initMap(){
 map=L.map('map').setView([40.7128,-74.0060],6);
 L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
 marker=L.marker([40.7128,-74.0060],{draggable:true}).addTo(map);
 marker.on("dragend",()=>{const p=marker.getLatLng();$("#lat").value=p.lat.toFixed(5);$("#lon").value=p.lng.toFixed(5);fetchWeather()});
 map.on("click",e=>{marker.setLatLng(e.latlng);$("#lat").value=e.latlng.lat.toFixed(5);$("#lon").value=e.latlng.lng.toFixed(5);fetchWeather()});
}
function renderKV(cur){const kv=$("#currentKV");kv.innerHTML="";for(const[k,v]of Object.entries(cur)){const d=document.createElement("div");d.innerHTML=`<b>${k}</b><br>${fmt(v)}`;kv.appendChild(d)}}
function renderTable(id,time,obj){const thead=$(id+" thead"),tbody=$(id+" tbody"),keys=Object.keys(obj).filter(k=>k!=="time");thead.innerHTML="<tr><th>time</th>"+keys.map(k=>`<th>${k}</th>`).join("")+"</tr>";tbody.innerHTML=time.map((t,i)=>"<tr><td>"+t+"</td>"+keys.map(k=>`<td>${fmt(obj[k][i])}</td>`).join("")+"</tr>").join("")}
async function fetchWeather(){
 const lat=$("#lat").value,lon=$("#lon").value;
 const url="https://api.open-meteo.com/v1/forecast?latitude="+lat+"&longitude="+lon+"&timezone=auto&forecast_days=16&current="+CURRENT+"&hourly="+HOURLY+"&daily="+DAILY;
 const r=await fetch(url);const j=await r.json();
 $("#tz").textContent="TZ: "+j.timezone;$("#place").textContent=`Selected: ${lat}, ${lon}`;
 if(j.current)renderKV(j.current);if(j.hourly)renderTable("#hourlyTable",j.hourly.time,j.hourly);if(j.daily)renderTable("#dailyTable",j.daily.time,j.daily);
}
document.querySelectorAll(".tab").forEach(b=>b.onclick=()=>{document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));b.classList.add("active");$("#"+b.dataset.t).classList.add("active");if(b.dataset.t==="now")setTimeout(()=>map.invalidateSize(),50)});
$("#go").onclick=fetchWeather;
$("#geo").onclick=()=>navigator.geolocation.getCurrentPosition(p=>{$("#lat").value=p.coords.latitude.toFixed(5);$("#lon").value=p.coords.longitude.toFixed(5);marker.setLatLng([p.coords.latitude,p.coords.longitude]);map.setView([p.coords.latitude,p.coords.longitude],9);fetchWeather()});
initMap();fetchWeather();
</script>
</body>
</html>