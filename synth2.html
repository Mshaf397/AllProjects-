<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web Synth Keyboard</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
    }
    .keyboard {
      display: flex;
      gap: 10px;
    }
    button {
      font-size: 1.2em;
      padding: 1em;
      border: none;
      border-radius: 5px;
      background: #eee;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #ccc;
    }
    .grid {
  display: grid;
  grid-template-columns: repeat(4, 100px);
  grid-template-rows: repeat(4, 100px);
  gap: 10px;
}

.grid button {
  font-size: 1.2em;
  border: none;
  border-radius: 8px;
  background: #eee;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}

.grid button:hover {
  background: #ccc;
}

.grid button:active {
  background: #999;
  transform: scale(0.95);
}
  </style>
</head>
<body>
  <h1>Web Synth</h1>
  <div class="grid">
  <button data-freq="261.63">C4</button>
  <button data-freq="293.66">D4</button>
  <button data-freq="329.63">E4</button>
  <button data-freq="349.23">F4</button>

  <button data-freq="392.00">G4</button>
  <button data-freq="440.00">A4</button>
  <button data-freq="493.88">B4</button>
  <button data-freq="523.25">C5</button>

  <button data-freq="587.33">D5</button>
  <button data-freq="659.25">E5</button>
  <button data-freq="698.46">F5</button>
  <button data-freq="783.99">G5</button>

  <button data-freq="880.00">A5</button>
  <button data-freq="987.77">B5</button>
  <button data-freq="1046.50">C6</button>
  <button data-freq="1174.66">D6</button>
</div>

  <script>
    const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

// keep track of active notes for polyphony
const activeNotes = {}; // frequency â†’ { oscillator, gainNode }

function startNote(frequency) {
  // prevent duplicate starts
  if (activeNotes[frequency]) return;

  const oscillator = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();

  oscillator.type = 'sine'; // changeable later
  oscillator.frequency.value = frequency;

  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);

  gainNode.gain.setValueAtTime(1, audioCtx.currentTime);

  oscillator.start();

  activeNotes[frequency] = { oscillator, gainNode };
}

function stopNote(frequency) {
  const note = activeNotes[frequency];
  if (note) {
    // fade out smoothly
    note.gainNode.gain.exponentialRampToValueAtTime(
      0.001,
      audioCtx.currentTime + 0.3
    );
    note.oscillator.stop(audioCtx.currentTime + 0.3);

    delete activeNotes[frequency];
  }
}

// attach listeners to all grid buttons
document.querySelectorAll(".grid button").forEach(btn => {
  const freq = parseFloat(btn.dataset.freq);

  // Mouse support
  btn.addEventListener("mousedown", () => startNote(freq));
  btn.addEventListener("mouseup", () => stopNote(freq));
  btn.addEventListener("mouseleave", () => stopNote(freq));

  // Touch support
  btn.addEventListener("touchstart", (e) => {
    e.preventDefault(); // prevents scrolling
    startNote(freq);
  });
  btn.addEventListener("touchend", (e) => {
    e.preventDefault();
    stopNote(freq);
  });
});

// unlock audio on first touch for iOS/Android
document.body.addEventListener("touchstart", () => {
  if (audioCtx.state === "suspended") {
    audioCtx.resume();
  }
}, { once: true });

// also unlock on first click (desktop Safari can suspend too)
document.body.addEventListener("mousedown", () => {
  if (audioCtx.state === "suspended") {
    audioCtx.resume();
  }
}, { once: true });
  </script>
</body>
</html>