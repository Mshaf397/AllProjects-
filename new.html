<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planetary Epoch Clock</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }

        /* Custom styling for text inputs to look consistent, overriding any default browser input styling */
        .text-input {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .text-input:focus {
            outline: none;
            border-color: #4f46e5; /* indigo-600 */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5); /* ring-indigo-500 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div id="app" class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-indigo-700">Planetary Epoch Clock</h1>
            <p class="text-gray-600 mt-2">Define the rules of your own time system and watch it tick.</p>
        </header>

        <!-- Current Planetary Time Display -->
        <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl mb-8">
            <h2 class="text-xl font-semibold mb-4 text-indigo-600">Current Planetary Time (HH:MM:SS)</h2>
            <div id="planetary-time" class="text-center font-mono text-4xl md:text-6xl text-gray-800 break-words transition duration-500 ease-in-out">
                00:00:00
            </div>

            <!-- Detailed Breakdown -->
            <div class="mt-6 text-sm md:text-base grid grid-cols-2 gap-4 text-gray-700">
                <div class="p-3 bg-indigo-50 rounded-lg shadow-inner">
                    <span class="font-bold text-indigo-700 block">Planetary Year:</span>
                    <span id="p-year">0</span>
                </div>
                <div class="p-3 bg-indigo-50 rounded-lg shadow-inner">
                    <span class="font-bold text-indigo-700 block">Planetary Day (of Year):</span>
                    <span id="p-day-of-year">0 / 0</span>
                </div>
                <div class="p-3 bg-indigo-50 rounded-lg shadow-inner col-span-2">
                    <span class="font-bold text-indigo-700 block">Time Since Epoch (ms):</span>
                    <span id="ms-elapsed">0</span>
                </div>
            </div>

            <!-- Day Progress Bar -->
            <div class="mt-8">
                <h3 class="text-lg font-medium mb-2 text-indigo-600">Planetary Day Progress (<span id="progress-percent">0.00</span>%)</h3>
                <div class="w-full bg-gray-200 rounded-full h-3 shadow-inner">
                    <div id="day-progress-bar" class="bg-indigo-500 h-3 rounded-full transition-all duration-100" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Configuration Panel -->
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-xl">
            <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">Custom Planetary Settings (Resets on Refresh)</h2>

            <div id="status" class="mb-4 text-sm font-medium p-2 rounded-lg bg-red-100 text-red-800">
                Data is NOT saved between sessions. Reset to Earth defaults on page load.
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <!-- EPOCH DEFINITION -->
                <div class="md:col-span-2 p-4 bg-gray-50 rounded-lg border-l-4 border-indigo-400">
                    <h3 class="font-bold text-lg mb-3 text-indigo-600">Epoch Definition (UTC)</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="epoch-date" class="block text-sm font-medium text-gray-700 mb-1">Epoch Date (YYYY-MM-DD)</label>
                            <!-- Changed type from 'date' to 'text' -->
                            <input type="text" id="epoch-date" value="2000-01-01" placeholder="YYYY-MM-DD" class="text-input focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label for="epoch-time" class="block text-sm font-medium text-gray-700 mb-1">Epoch Time (HH:MM:SS)</label>
                            <!-- Changed type from 'time' to 'text' -->
                            <input type="text" id="epoch-time" value="00:00:00" placeholder="HH:MM:SS" class="text-input focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>
                </div>

                <!-- PLANETARY DEFINITION -->
                <div class="md:col-span-2 p-4 bg-gray-50 rounded-lg border-l-4 border-indigo-400">
                    <h3 class="font-bold text-lg mb-3 text-indigo-600">Planetary Time System Rules</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">Days per Year (D/Y)</span>
                            <input type="number" min="1" id="days-per-year" value="365" class="text-input mt-1" required>
                        </label>
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">Hours per Day (H/D)</span>
                            <input type="number" min="1" id="hours-per-day" value="24" class="text-input mt-1" required>
                        </label>
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">Minutes per Hour (M/H)</span>
                            <input type="number" min="1" id="minutes-per-hour" value="60" class="text-input mt-1" required>
                        </label>
                        <label class="block">
                            <span class="text-sm font-medium text-gray-700">Seconds per Minute (S/M)</span>
                            <input type="number" min="1" id="seconds-per-minute" value="60" class="text-input mt-1" required>
                        </label>
                        <label class="block sm:col-span-2">
                            <span class="text-sm font-medium text-gray-700">Real Milliseconds per Planetary Second (MS/S)</span>
                            <input type="number" min="1" id="ms-per-second" value="1000" class="text-input mt-1" required>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Script Logic -->
    <script>
        // Default Earth-based settings (always loaded on start)
        const DEFAULT_SETTINGS = {
            epochDate: '2000-01-01',
            epochTime: '00:00:00',
            daysPerYear: 365,
            hoursPerDay: 24,
            minutesPerHour: 60,
            secondsPerMinute: 60,
            msPerSecond: 1000,
        };

        let settings = { ...DEFAULT_SETTINGS };
        let intervalId = null;

        const elements = {
            epochDate: document.getElementById('epoch-date'),
            epochTime: document.getElementById('epoch-time'),
            daysPerYear: document.getElementById('days-per-year'),
            hoursPerDay: document.getElementById('hours-per-day'),
            minutesPerHour: document.getElementById('minutes-per-hour'),
            secondsPerMinute: document.getElementById('seconds-per-minute'),
            msPerSecond: document.getElementById('ms-per-second'),
            planetaryTimeDisplay: document.getElementById('planetary-time'),
            pYear: document.getElementById('p-year'),
            pDayOfYear: document.getElementById('p-day-of-year'),
            msElapsed: document.getElementById('ms-elapsed'),
            progressBar: document.getElementById('day-progress-bar'),
            progressPercent: document.getElementById('progress-percent'),
            status: document.getElementById('status')
        };

        // --- INITIALIZATION & INPUT HANDLING ---

        function initializeApp() {
            // Apply default settings and start the clock immediately
            applySettingsToUI(DEFAULT_SETTINGS);
            setupInputListeners();
            startClock();
        }

        function applySettingsToUI(currentSettings) {
            elements.epochDate.value = currentSettings.epochDate;
            elements.epochTime.value = currentSettings.epochTime;
            elements.daysPerYear.value = currentSettings.daysPerYear;
            elements.hoursPerDay.value = currentSettings.hoursPerDay;
            elements.minutesPerHour.value = currentSettings.minutesPerHour;
            elements.secondsPerMinute.value = currentSettings.secondsPerMinute;
            elements.msPerSecond.value = currentSettings.msPerSecond;
            settings = currentSettings; // Update global settings object
        }

        function setupInputListeners() {
            // Get all input elements in the configuration panel
            const configInputs = document.querySelectorAll('#app input');

            configInputs.forEach(el => {
                // Listen for change (e.g., blur/enter) and keyup for immediate feedback
                el.addEventListener('change', updateSettingsFromUI);
                el.addEventListener('keyup', updateSettingsFromUI);
            });
        }

        function updateSettingsFromUI() {
            const newSettings = {
                // Text inputs for date and time are used directly
                epochDate: elements.epochDate.value,
                epochTime: elements.epochTime.value,
                // Ensure number values are positive integers
                daysPerYear: Math.max(1, parseInt(elements.daysPerYear.value) || 1),
                hoursPerDay: Math.max(1, parseInt(elements.hoursPerDay.value) || 1),
                minutesPerHour: Math.max(1, parseInt(elements.minutesPerHour.value) || 1),
                secondsPerMinute: Math.max(1, parseInt(elements.secondsPerMinute.value) || 1),
                msPerSecond: Math.max(1, parseInt(elements.msPerSecond.value) || 1),
            };
            
            // Update global settings immediately
            settings = newSettings; 
            updateClock();
        }

        // --- CORE CLOCK LOGIC ---

        function startClock() {
            if (intervalId) {
                clearInterval(intervalId); // Clear existing interval if restarting
            }
            // Start the clock update loop every 10ms for high precision
            updateClock();
            intervalId = setInterval(updateClock, 10); 
        }

        function updateClock() {
            // 1. Calculate Epoch Time in UTC milliseconds
            // Combine date and time strings into ISO format with UTC suffix 'Z'
            const epochDateTimeString = `${settings.epochDate}T${settings.epochTime}.000Z`;
            const epochMs = Date.parse(epochDateTimeString);

            // Handle invalid date/time parsing
            if (isNaN(epochMs)) {
                elements.planetaryTimeDisplay.textContent = 'Invalid Epoch';
                return;
            }

            // 2. Calculate elapsed real time since epoch
            const nowMs = Date.now();
            const msElapsedSinceEpoch = nowMs - epochMs;
            elements.msElapsed.textContent = msElapsedSinceEpoch.toLocaleString();

            if (msElapsedSinceEpoch < 0) {
                elements.planetaryTimeDisplay.textContent = 'Future Epoch';
                return;
            }

            // 3. Define Planetary Conversion Factors (Total Real MS in each custom unit)
            const MS_PER_P_SECOND = settings.msPerSecond;
            const MS_PER_P_MINUTE = MS_PER_P_SECOND * settings.secondsPerMinute;
            const MS_PER_P_HOUR = MS_PER_P_MINUTE * settings.minutesPerHour;
            const MS_PER_P_DAY = MS_PER_P_HOUR * settings.hoursPerDay;
            const MS_PER_P_YEAR = MS_PER_P_DAY * settings.daysPerYear;

            // Prevent division by zero if input values are invalid
            if (MS_PER_P_YEAR === 0 || MS_PER_P_DAY === 0) return;


            // 4. Calculate Planetary Time Components
            let remainingMs = msElapsedSinceEpoch;

            // Calculate Years
            const pYears = Math.floor(remainingMs / MS_PER_P_YEAR);
            remainingMs %= MS_PER_P_YEAR;

            // Calculate Days (of Year)
            const pDays = Math.floor(remainingMs / MS_PER_P_DAY);
            remainingMs %= MS_PER_P_DAY;

            // Calculate Hours
            const pHours = Math.floor(remainingMs / MS_PER_P_HOUR);
            remainingMs %= MS_PER_P_HOUR;

            // Calculate Minutes
            const pMinutes = Math.floor(remainingMs / MS_PER_P_MINUTE);
            remainingMs %= MS_PER_P_MINUTE;

            // Calculate Seconds
            const pSeconds = Math.floor(remainingMs / MS_PER_P_SECOND);
            // The remaining are Milliseconds (not displayed in main clock)

            // 5. Update UI

            // Helper function to format time components (e.g., 5 -> "05")
            const format = (num, length) => String(num).padStart(length, '0');

            // MAIN DISPLAY: HH:MM:SS (as requested, without milliseconds)
            const formattedTime = `${format(pHours, 2)}:${format(pMinutes, 2)}:${format(pSeconds, 2)}`;

            elements.planetaryTimeDisplay.textContent = formattedTime;
            elements.pYear.textContent = pYears.toLocaleString();
            // Days are 0-indexed (0 to DaysPerYear-1), so we add 1 for display
            elements.pDayOfYear.textContent = `${(pDays + 1).toLocaleString()} / ${settings.daysPerYear}`;

            // 6. Update Day Progress Bar
            const msPassedToday = msElapsedSinceEpoch % MS_PER_P_DAY;
            const progress = (msPassedToday / MS_PER_P_DAY) * 100;

            elements.progressBar.style.width = `${progress}%`;
            elements.progressPercent.textContent = progress.toFixed(2);
        }

        // --- INITIALIZATION ---
        window.onload = initializeApp;

    </script>
</body>
</html>